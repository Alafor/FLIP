<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hk.flip.Class">

	<!-- 강사들의 강의 10개만 불러오기 -->
	<select id="mainclasslist" parameterType="String"
		resultType="ClassDto">
	<![CDATA[ 
		SELECT
		E.SEQ,
		E.CLASS_NAME,
		E.CLASS_PRICE,
		E.CLASS_INSTRUCTOR,
		E.CLASS_IMG,
		D.RATING ClASS_RATING,
		E.CLASS_AREA,
		F.PARTICIPATION CLASS_PARTICIPATION,
		F.D_DAY CLASS_D_DAY,
		MEMBERS.MEMBER_PROFILE AS PROFILE_IMG
		FROM
		CLASS E,
		(SELECT CLASS.CLASS_INSTRUCTOR, ROUND(AVG(REVIEW.REVIEW_RATING),1) AS RATING
		FROM REVIEW, CLASS WHERE REVIEW.REVIEW_CLASS_SEQ = CLASS.SEQ GROUP BY
		CLASS.CLASS_INSTRUCTOR ORDER BY RATING DESC) D,
		(SELECT
		SEQ,
		(SELECT COUNT(INCLASS.SEQ) FROM INCLASS WHERE INCLASS.SEQ = CLASS.SEQ) AS
		PARTICIPATION,
		(TO_CHAR(CLASS.CLASS_SD,'YYYYMMDD')-TO_CHAR(SYSDATE,'YYYYMMDD')) AS
		D_DAY FROM CLASS) F,
		(SELECT MEMBER.MEMBER_ID,MEMBER.MEMBER_PROFILE FROM MEMBER) MEMBERS
		WHERE 
		E.CLASS_INSTRUCTOR=D.CLASS_INSTRUCTOR
		AND E.SEQ = F.SEQ 
		AND MEMBERS.MEMBER_ID = D.CLASS_INSTRUCTOR
		AND e.CLASS_DEPA = #{department}
		AND ROWNUM <= 10
	]]>
	</select>

	<!-- 강사들의 강의 인기순 10개만 불러오기 -->
	<select id="mainpopularclasslist">
	<![CDATA[
	SELECT 
	e.SEQ,
	e.CLASS_TYPE,
	e.CLASS_NAME name,
	e.CLASS_PRICE price,
	e.CLASS_INSTRUCTOR instructor,
	e.CLASS_IMG img,
	d.RATING rating,
	e.CLASS_AREA area,
	f.participation,
	f.d_day,
	members.MEMBER_PROFILE AS profile_img	
  	FROM 
  	CLASS e,
  	(SELECT CLASS.CLASS_INSTRUCTOR, round(AVG(REVIEW.REVIEW_RATING),1) AS RATING FROM REVIEW, CLASS WHERE REVIEW.REVIEW_CLASS_SEQ = CLASS.SEQ GROUP BY CLASS.CLASS_INSTRUCTOR ORDER BY RATING  desc) d,
  	(SELECT 
    SEQ,
	(SELECT COUNT(INCLASS.SEQ) FROM INCLASS WHERE INCLASS.SEQ = CLASS.SEQ) AS participation,
	(TO_CHAR(CLASS.CLASS_SD,'YYYYMMDD')-TO_CHAR(SYSDATE,'YYYYMMDD')) AS d_day FROM CLASS) f,
	(SELECT MEMBER.MEMBER_ID,MEMBER.MEMBER_PROFILE FROM MEMBER) members
 	WHERE e.CLASS_INSTRUCTOR=d.CLASS_INSTRUCTOR
	AND e.SEQ = f.SEQ AND members.MEMBER_ID = d.CLASS_INSTRUCTOR AND ROWNUM <= 9;
	]]>
	</select>
</mapper>