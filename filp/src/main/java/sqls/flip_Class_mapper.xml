<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hk.flip.Class">

	<!-- 강사들의 강의 10개만 불러오기 -->
<select id="mainclasslist" parameterType="String" resultType="ClassDto">
	<![CDATA[ 
	SELECT
	C.CLASS_IMG,
	C.CLASS_MEMBER_SEQ,
	M.MEMBER_NAME,
	M.MEMBER_PROFILE,
	R.CLASS_RATING,
	C.CLASS_NAME,
	C.CLASS_INFO,
	C.CLASS_AREA,
	D_DAY.CLASS_D_DAY,
	PARTI.CLASS_NOW_PARTICIPATION
	FROM
	CLASS C,
	MEMBER M,
	(SELECT CLASS.CLASS_MEMBER_SEQ, ROUND(AVG(REVIEW.REVIEW_RATING),1) AS CLASS_RATING
   		FROM REVIEW, CLASS
   		WHERE REVIEW.REVIEW_CLASS_SEQ = CLASS.SEQ 
   		GROUP BY CLASS.CLASS_MEMBER_SEQ 
   		ORDER BY CLASS_RATING DESC) R,
   	(SELECT CLASS.SEQ,(TO_CHAR(CLASS.CLASS_SD,'YYYYMMDD')-TO_CHAR(SYSDATE,'YYYYMMDD')) AS CLASS_D_DAY FROM CLASS) D_DAY,
   	(SELECT CL.SEQ,COUNT(INC.INCLASS_CLASS_SEQ) AS CLASS_NOW_PARTICIPATION 
   		FROM INCLASS INC, CLASS CL 
   		WHERE INC.INCLASS_CLASS_SEQ = CL.SEQ 
   		GROUP BY CL.SEQ) PARTI
	WHERE
	C.CLASS_MEMBER_SEQ = R.CLASS_MEMBER_SEQ
	AND C.CLASS_MEMBER_SEQ = M.MEMBER_SEQ
	AND C.SEQ = D_DAY.SEQ
	AND C.SEQ = PARTI.SEQ
	AND C.CLASS_DEPA = #{department} 
	AND ROWNUM <= 10
	]]>
	</select>
</mapper>